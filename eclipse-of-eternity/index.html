<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="canonical" href="https://codingblink.com/eclipse-of-eternity">
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
    <meta name="description" content="Eclipse of Eternity is an open-world RPG set to release in December 2028. Sign up before the early deadline to earn 1 year of game time for free!"/>
    <title>Eclipse of Eternity: Pre-Impact</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="particles.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.0/css/all.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Almendra+SC&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Caudex&display=swap" rel="stylesheet">
    <link rel="icon" href="https://codingblink.com/eclipse-of-eternity/favicon.ico" type="image/x-icon">
    <style>
        *{
            font-family: 'Poppins';
            font-weight: bold;
        }
        .fade-in-opacity{
            animation: fadeInOpacity 2s ease-out;
        }
        .medieval-button{
            font-family: 'Almendra SC';
            letter-spacing: 2px;
            font-weight: bold;
        }
        .title-font{
            font-family: 'Caudex';
            letter-spacing: 5px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-shadow: 2px 2px 6px rgba(255,255,255,1);
        }
        @keyframes ellipticalMotion{
            0%{transform: translateX(0px) translateY(0px);}
            25%{transform: translateX(-5px) translateY(-2.5px);}
            50%{transform: translateX(-10px) translateY(0px);}
            75%{transform: translateX(-5px) translateY(2.5px);}
            100%{transform: translateX(0px) translateY(0px);}
        }
        .terrain{
            animation: fadeHalfOutOpacity 5s ease-out;
            opacity: 0.5;
        }
        .terrain{
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 200px;
            background-color: #2d2b2b;
            clip-path: polygon(0% 100%,20% 40%,40% 50%,60% 30%,80% 50%,100% 40%,100% 100%);
            z-index: 0;
        }
        .asteroid{
            position: absolute;
            top: 20%;
            right: 20%;
            width: 300px;
            height: 300px;
            background-color: #3a3a3a;
            clip-path: polygon(
                50% 0%,
                65% 5%,
                80% 15%,
                90% 30%,
                95% 45%,
                100% 60%,
                90% 75%,
                80% 85%,
                65% 95%,
                50% 100%,
                35% 95%,
                20% 85%,
                10% 75%,
                5% 60%,
                0% 45%,
                10% 30%,
                20% 15%
            );
            z-index: -1;
            opacity: 0.4;
            filter: blur(2px);
        }
        .asteroid-glints{
            position: absolute;
            top: 20%;
            right: 20%;
            width: 300px;
            height: 300px;
            pointer-events: none;
            z-index: 0;
        }
        .crystal-glint{
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle,rgba(255,192,255,0.9),rgba(255,192,255,0.2));
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle at center,rgba(255,192,255,0.9),rgba(255,192,255,0.2));
            filter: drop-shadow(0 0 3px rgba(255,192,255,0.6));
            animation: shimmer 3s infinite ease-in-out;
            opacity: 0.8;
            clip-path: polygon(50% 0%,80% 30%,100% 80%,60% 100%,30% 80%,0% 40%);
            filter: blur(1px);
            animation: shimmer 3s infinite ease-in-out;
            opacity: 0.7;
        }
        @keyframes shimmer{
            0%,100%{transform: scale(1.4);opacity: 0.7;}
            50%{transform: scale(1.5);opacity: 1;}
        }
        .light{
            position: fixed;
            width: 10px;
            height: 10px;
            background: #ffd700;
            border-radius: 50%;
            box-shadow: 0 0 30px 10px rgba(255,215,0,0.5);
            z-index: 2501;
            animation: flicker 2s infinite ease-in-out;
        }
        .fire-particle{
            position: absolute;
            width: 4px;
            height: 20px;
            background: linear-gradient(to bottom,rgba(255,80,80,0.9),rgba(255,0,0,0));
            border-radius: 50%;
            opacity: 0.7;
            transform: rotate(-45deg);
            animation: flickerParticle 1.2s infinite ease-in-out;
            pointer-events: none;
            z-index: 700;
        }
        @keyframes flickerParticle{
            0%{
                opacity: 0.8;
                transform: translateY(0) rotate(-135deg) scaleY(1);
            }
            50%{
                opacity: 0.4;
                transform: translateY(-5px) rotate(-135deg) scaleY(1.2);
            }
            100%{
                opacity: 0.8;
                transform: translateY(0) rotate(-135deg) scaleY(1);
            }
        }
        @keyframes flicker{
            0%,100%{ box-shadow: 0 0 30px 10px rgba(255,215,0,0.5); }
            50%{ box-shadow: 0 0 40px 15px rgba(255,215,0,0.7); }
        }
        @keyframes expandForm{
            0%{
                transform: scale(0.1);
                opacity: 0;
            }
            30%{
                transform: scale(0.9);
            }
            100%{
                transform: scale(1);
                opacity: 1;
            }
        }
        @keyframes fadeInOpacity{
            0%{
                opacity: 0;
            }
            100%{
                opacity: 1;
            }
        }
        @keyframes fadeHalfOutOpacity{
            0%{
                opacity: 1;
            }
            100%{
                opacity: 0.5;
            }
        }
        @keyframes fadeOutOpacity{
            0%{
                opacity: 1;
                transform: scale(1);
            }
            25%{
                opacity: 0.1;
            }
            50%{
                opacity: 0;
                transform: scaleX(0.5) scaleY(0.5);
            }
            51%{
                transform: scale(0.1);
            }
            66%{
                transform: scale(0.9);
                opacity: 0.32;
            }
            100%{
                transform: scale(1);
                opacity: 1;
            }
        }
        .fade-out-opacity{
            animation: fadeOutOpacity 4s ease-out;
        }
        .eclipse-container{
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%,-50%);
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: radial-gradient(circle,rgba(255,200,50,0.1) 0%,rgba(255,100,0,0.2) 60%,transparent 80%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: -2;
            animation: glowPulse 3s infinite ease-in-out;
        }
        .eclipse-core{
            width: 120px;
            height: 120px;
            background-color: #000;
            border-radius: 50%;
            box-shadow: 0 0 30px 10px rgba(255,150,0,0.3),0 0 60px 25px rgba(255,150,0,0.15);
        }
        @keyframes glowPulse{
            0%,100%{
                box-shadow: 0 0 60px 25px rgba(255,150,0,0.15);
            }
            50%{
                box-shadow: 0 0 80px 35px rgba(255,180,0,0.25);
            }
        }
        input{
            transition: all 0.3s ease;
        }
        .star{
            position: absolute;
            width: 2px;
            height: 2px;
            background-color: white;
            border-radius: 50%;
            box-shadow: 0 0 6px 2px rgba(255,255,255,0.6);
            opacity: 0.8;
            animation: twinkle 4s infinite ease-in-out alternate;
        }
        @keyframes twinkle{
            0%{ opacity: 0.4;
                transform: scale(1);
            }
            100%{
                opacity: 1;
                transform: scale(1.2);
            }
        }
        .special-text{
            font-family: 'Almendra SC';
        }
        .eoe-chat-window-open{
            opacity: 1 !important;
            pointer-events: auto !important;
            transform: scale(1) translate(0,0) !important;
        }
        .eoe-chat-window-closed{
            opacity: 0 !important;
            pointer-events: none !important;
            transform: scale(0.90) translate(40px,0);
        }
        @media (max-width: 767px){
            #eoe-chat-window{
                max-width: 98vw !important;
                min-width: 90vw !important;
                right: 4vw !important;
                left: auto !important;
                bottom: 4vw !important;
                top: auto !important;
                border-radius: 18px !important;
                transform-origin: bottom right !important;
            }
            .eoe-chat-window-open{
                opacity: 1;
                pointer-events: auto !important;
                transform: scale(0.98) translate(0,-10px) !important;
            }
            .eoe-chat-window-closed{
                opacity: 0;
                pointer-events: none !important;
                transform: scale(0.92) translate(30px,10px);
            }
        }
        @media (max-height: 850px){
            .chat-container-div{
                transform: scale(0.9) translateX(10%) translateY(10%) !important;
            }
            #eoe-chat-scroll{
                max-height: 250px !important;
                height: 250px !important;
            }
        }
        @media (max-height: 1150px){
            #eoe-chat-scroll{
                max-height: 550px;
                height: 550px;
            }
        }
        @media (max-height: 1000px){
            #eoe-chat-scroll{
                max-height: 250px !important;
                height: 250px !important;
            }
        }
        ::-webkit-scrollbar{
            width: 8px;
            background: transparent;
        }
        ::-webkit-scrollbar-thumb{
            background: linear-gradient(180deg,#be123c 40%,#a21caf 100%);
            border-radius: 6px;
        }
        ::-webkit-scrollbar-track{
            background: rgba(90,0,20,0.2);
            border-radius: 8px;
        }
        #eoe-chat-scroll{
            scrollbar-width: thin;
            scrollbar-color: #be123c rgba(90,0,20,0.2);
        }
        html{
            scroll-behavior: smooth;
            background-color: black;
        }
        #eoe-chat-window{
            z-index: 3500;
        }
        @keyframes blink{ 50%{ opacity: 0; } }
        .blink{
            animation: blink 1s steps(2,start) infinite;
        }
        @keyframes disappear{
            0%{
                opacity: 0%;
            }
            5%{
                opacity: 100%;
            }
            90%{
                opacity: 100%;
            }
            99%{
                opacity: 0%;
            }
            100%{
                opacity: 0%;
            }
        }
        .animate-disappear {
            animation: disappear 10s ease-out;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes spin-reverse {
            from { transform: rotate(0deg); }
            to { transform: rotate(-360deg); }
        }
        .minute-hand {
            transform-origin: 50px 50px;
            animation: spin-reverse 5s linear infinite;
        }
        .hour-hand {
            transform-origin: 50px 50px;
            animation: spin 8s linear infinite;
        }
        .text-card {
            background: rgba(20, 0, 30, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
        }

        .text-card:hover {
            background: rgba(30, 0, 40, 0.9);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(150, 0, 200, 0.3);
        }

        @media (max-width: 1024px) {
            .asteroid {
                right: 5% !important;
                transform: scale(0.7);
            }
        }

        @media (max-width: 768px) {
            .eclipse-container {
                top: 25%;
                transform: translate(-50%, -50%) scale(0.8);
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-[#0d001a] via-[#0d001a] to-black text-white flex justify-center overflow-x-hidden">
    <!-- Background -->
    <div class="asteroid z-[499]" id="asteroid"></div>
    <div class="asteroid-glints absolute top-[20%] right-[20%] w-[300px] h-[300px] pointer-events-none z-[500]">
        <div class="crystal-glint top-[30px] left-[160px] w-[16px] h-[16px]"></div>
        <div class="crystal-glint top-[60px] left-[180px] w-[12px] h-[12px]"></div>
        <div class="crystal-glint top-[90px] left-[170px] w-[10px] h-[10px]"></div>
        <div class="crystal-glint top-[40px] left-[140px] w-[14px] h-[14px]"></div>
        <div class="crystal-glint top-[70px] left-[150px] w-[11px] h-[11px]"></div>
        <div class="crystal-glint top-[120px] left-[160px] w-[13px] h-[13px]"></div>
        <div class="crystal-glint top-[50px] left-[130px] w-[15px] h-[15px]"></div>
        <div class="crystal-glint top-[80px] left-[190px] w-[10px] h-[10px]"></div>
        <div class="crystal-glint top-[110px] left-[140px] w-[12px] h-[12px]"></div>
        <div class="crystal-glint top-[130px] left-[180px] w-[14px] h-[14px]"></div>
    </div>
    <div class="terrain z-[2400]"></div>
    <div class="light" style="bottom: 10%; left: 10%;"></div>
    <div class="light" style="bottom: 13%; left: 30%;"></div>
    <div class="light" style="bottom: 10%; left: 50%;"></div>
    <div class="light" style="bottom: 15%; left: 70%;"></div>
    <div class="light" style="bottom: 11%; left: 90%;"></div>
    <div class="z-[50] eclipse-container">
        <div class="eclipse-core"></div>
        <div class="absolute flex justify-center items-center translate-y-[250%] scale-[3]">
            <svg class="w-40 h-40 drop-shadow-[0_0_10px_white]" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="50" r="44" stroke="white" stroke-dasharray="3,4" stroke-width="1" fill="none" opacity="0.5"/>
                <circle cx="50" cy="50" r="48" stroke="white" stroke-width="2" fill="none"/>
                <text x="50" y="18" text-anchor="middle" fill="white" font-size="6" font-family="serif">XII</text>
                <text x="85" y="55" text-anchor="middle" fill="white" font-size="6" font-family="serif">III</text>
                <text x="50" y="95" text-anchor="middle" fill="white" font-size="6" font-family="serif">VI</text>
                <text x="15" y="55" text-anchor="middle" fill="white" font-size="6" font-family="serif">IX</text>
                <g class="hour-hand">
                    <line x1="50" y1="50" x2="50" y2="30" stroke="white" stroke-width="2" stroke-linecap="round"/>
                    <path d="M49,35 L51,35 L50,20 Z" fill="white"/>
                    <path d="M47,30 L53,30 L50,31 Z" fill="white"/>
                    <circle cx="50" cy="30" r="1.5" fill="white"/>
                </g>
                <g class="minute-hand">
                    <line x1="50" y1="50" x2="50" y2="20" stroke="white" stroke-width="2" stroke-linecap="round"/>
                    <path d="M49,25 L51,25 L50,10 Z" fill="white"/>
                    <path d="M47,20 L53,20 L50,21 Z" fill="white"/>
                    <circle cx="50" cy="20" r="1.5" fill="white"/>
                </g>
                <circle cx="50" cy="50" r="3" fill="white" stroke="white" stroke-width="1"/>
            </svg>
        </div>
    </div>
    <div class="fade-in-opacity fixed top-0 left-0 w-full h-32 bg-gradient-to-b from-red-700 to-transparent z-[3000]"></div>
    <div class="fixed top-4 right-4 flex flex-row gap-6 z-[3003]">
        <a href="./signup.html" class="text-white hover:text-yellow-500 md:text-lg text-sm transition duration-300">
            <i class="fas fa-right-to-bracket inline mr-2"></i>Sign Up
        </a>
    </div>
    <h1 class="fixed text-lg md:text-2xl md:pt-4 pt-10 font-extrabold mb-4 text-white title-font z-[3001]">Eclipse of Eternity</h1>
    
    <!-- Links -->
    <div class="fixed top-4 left-4 transform flex gap-6 z-[3002] transition-all">
        <a href="https://codingblink.com" class="text-white opacity-50 hover:opacity-100 hover:text-yellow-400 text-2xl transition">
            <i class="fas fa-home"></i>
        </a>
    </div>
    <div class="fixed bottom-4 left-1/2 transform -translate-x-1/2 flex gap-6 z-[2500]">
        <a href="https://discord.gg/GnGEwzwvGe" target="_blank" class="text-white hover:text-indigo-400 text-2xl transition">
            <i class="fab fa-discord"></i>
        </a>
        <a href="https://twitter.com/eoe_game" target="_blank" class="text-white hover:text-sky-400 text-2xl transition">
            <i class="fab fa-twitter"></i>
        </a>
        <a href="mailto:eclipseofeternityofficial@gmail.com" class="text-white hover:text-red-400 text-2xl transition">
            <i class="fas fa-envelope"></i>
        </a>
        <a href="https://www.gofundme.com/f/support-pierres-dream-eclipse-of-eternity-game" target="_blank" class="text-white hover:text-green-400 text-2xl transition">
            <i class="fas fa-hand-holding-heart"></i>
        </a>
    </div>
    <div class="fixed bottom-4 right-4 flex flex-row gap-6 z-[2500]">
        <a href="legal.html" class="text-gray-400 hover:text-red-500 lg:text-lg text-xs transition">
            <p class="mr-2 inline">Legal</p><i class="fas fa-gavel inline"></i>
        </a>
    </div>
    <div id="pingDisplay" class="fixed bottom-4 left-4 flex flex-row gap-6 z-[2500] opacity-80 hover:opacity-100">
        <span class="hidden md:block"><i class="fas fa-wifi mr-1"></i>Pinging server...</span><span class="md:hidden block"><i class="fas fa-wifi mr-1"></i><span>
    </div>
    <!-- NEW! (Under Construction) AI Chat -->
    <div id="eoe-chat-bubble" class="fixed z-[3499] right-6 bottom-16 md:bottom-[85%] md:top-auto bg-gradient-to-b from-[#180025] via-[#22002c] to-[#110015] border border-red-700 rounded-xl shadow-lg shadow-red-900/30 opacity-80 hover:opacity-100 transition-all duration-500 cursor-pointer sm:w-60 w-16 h-16 flex items-center justify-center group md:w-52 md:h-14 hover:scale-110 hover:translate-x-[-20px]">
        <div class="z-[2450] w-full flex items-center gap-3 px-5 pointer-events-none">
            <span class="sm:block hidden text-md block text-base text-red-400 font-semibold tracking-wider group-hover:text-white transition">Chat with NPCs</span>
            <i class="fas fa-comments text-lg text-purple-300 group-hover:text-red-300 transition"></i>
        </div>
    </div>
    <div id="eoe-chat-window" class="fixed bottom-40 right-4 md:right-16 lg:max-w-2xl w-[95vw] max-w-sm md:max-w-md min-h-[430px] opacity-0 pointer-events-none transition-transform transition-opacity duration-500 origin-bottom-right md:origin-right">
        <div class="chat-container-div scale-85 lg:scale-90 bg-gradient-to-b from-[#210033] via-[#32002d] to-black border border-red-800 rounded-2xl shadow-2xl shadow-red-900/50">
            <div class="relative bg-gradient-to-r from-[#31001a] via-[#480024] to-transparent px-5 py-3 rounded-t-2xl border-b border-red-900 flex items-center justify-between">
                <h2 class="text-sm sm:text-lg md:text-xl font-bold text-red-400 flex items-center mr-8">
                    <i class="fas fa-comments text-sm sm:text-lg md:text-xl text-purple-300 mr-2"></i>
                    Chat with the NPCs in Eclipse of Eternity!
                </h2>
                <button id="eoe-chat-close" aria-label="Close chat" class="absolute top-3 right-5 md:top-3 md:right-5 h-7 w-7 flex items-center justify-center rounded-full hover:bg-red-900/70 focus:outline-none focus:ring-2 focus:ring-red-600 transition">
                    <span class="sr-only">Close</span>
                    <i class="fas fa-times text-lg text-red-200"></i>
                </button>
            </div>
            <p class="text-xs md:text-sm text-gray-300 px-5 mt-1 mb-2 py-2 border-b border-red-800">
                <span class="scale-text-size scale-line-height"><span class="text-red-300 font-semibold">NEW EXPERIENCE:</span>
                Forget rigid dialog trees! These NPCs are powered by Generative AI.<br>
                <br>
                Ask for <span class="text-pink-300">directions</span>, advice, hints, lore, or even <span class="text-pink-300">complex questions</span> like <em>“how do I get to the city of Lysara?”</em>.<br>
                Each conversation shapes your journey in unique ways.</span>
            </p>
            <div id="eoe-chat-scroll" class="lg:max-h-[720px] lg:h-[720px] md:max-h-[480px] md:h-[480px] h-80 max-h-64 flex-1 overflow-y-auto px-5 py-6 bg-gradient-to-t from-black/80 via-transparent to-transparent">
                <div class="flex items-start gap-3 mb-4">
                    <div class="flex-shrink-0">
                    </div>
                    <div class="chat-area" id="chat-area">
                        <div id="eoe-chat-spinner" class="flex items-center gap-2 mb-4">
                            <span class="inline-block w-6 h-6 border-4 border-red-500 border-t-transparent rounded-full animate-spin"></span>
                            <span class="text-red-300 text-sm">Akira is thinking...</span>
                        </div>
                    </div>
                </div>
            </div>
            <form autocomplete="off" onsubmit="sendAIMessage(event);" class="bg-[#180016] px-5 py-4 border-t border-red-800 flex flex-col items-stretch">
                <div class="flex gap-2">
                    <input type="text" placeholder="Suggestion: Suggest me some wizard names." id="chatTextInput"
                        class="flex-1 rounded-lg px-3 py-1 md:py-2 bg-black/60 border border-red-800 text-white font-medium shadow-inner outline-none transition disabled:cursor-not-allowed disabled:bg-black/60 disabled:text-gray-500 text-xs md:text-base"/>
                    <button type="submit" id="chatSubmitButton"
                        class="bg-gradient-to-bl from-red-900 via-red-700 to-purple-800 text-red-100 font-semibold px-4 py-2 rounded-lg shadow hover:scale-105 transition disabled:opacity-60 disabled:cursor-not-allowed">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <p class="scale-text-size text-xs text-gray-400 mt-2 text-left">
                    Generated by AI.&nbsp;
                    <span class="text-red-400 font-semibold">Generative AI can make mistakes.</span> Information may not be factual.
                </p>
            </form>
        </div>
    </div>
    <div class="bg-gradient-to-b from-[#0d001a]/0 via-[#0d001a] to-black fixed bottom-0 h-[30%] w-full z-[2300]"></div>
    <div class="bg-gradient-to-t from-[#0d001a]/0 via-[#0d001a] to-[#0d001a] fixed top-0 h-[20%] w-full z-[1950]"></div>
    <div id="content-grid" class="my-32 md:my-64 container mx-auto px-4 py-8 grid lg:grid-cols-3 md:grid-cols-2 grid-cols-1 gap-8 z-[1000] relative">
        <!-- Content will be dynamically inserted here -->
    </div>
</body>
<script>
    const chatArea=document.getElementById('chat-area');
    async function typeTextAndStream(response) {
        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let result = '';

        while (true) {
            const { done, value } = await reader.read();
            if (done) break;
            const chunk = decoder.decode(value, { stream: true });
            result += chunk;
        }
    }
    const aiEnums = {
        unauthorized: 0,
        aiNotSubscribed: 1,
        tooManyCCU: 2,
        unknownCommand: 3,    
        clearedChatSuccess: 4
    }
    async function handleError(res) {
        const json = await res.json();
        console.log(json);
        const errorCode = json.e || -1;
        if (errorCode === aiEnums.unauthorized) {
            eoeAIReply("Sorry, but you need to be signed in to chat with this Eclipse of Eternity AI.");
        } else if (errorCode === aiEnums.aiNotSubscribed) {
            eoeAIReply("Sorry, but your CodingBlink account doesn't have access to this Eclispe of Eternity AI.");
        } else if (errorCode === aiEnums.tooManyCCU) {
            eoeAIReply("Sorry, but too many people are talking with Akira right now. Try to reach him later.");
        } else if (errorCode === aiEnums.unknownCommand) {
            eoeAIReply("That's not a valid command. Did you mean '/clearchat', to clear the chat? Try typing it again.");
        } else if (errorCode === aiEnums.clearedChatSuccess) {
            eoeAIReply("I've now forgotten everything we talked about. What brings you here, adventurer?");
        } else {
            console.log("invalid error code",errorCode,json.e)
        }
    }
    let chatTextInput = document.getElementById("chatTextInput");
    function sendAIMessage(e) {
        e.preventDefault();
        apiRequest("https://api.codingblink.com:443/aichat", { t: "Akira Kaida", m: chatTextInput.value }, typeTextAndStream, errorHandle=handleError);
    }
    const gameContent = [
        {
            title: "What is Eclipse of Eternity?",
            content: "Eclipse of Eternity is an <span class='text-blue-400'>Open-world RPG Game</span> that is set to release on <span class='text-purple-400'>December 2028</span>. It all starts with <span class='text-red-500'>a living meteor</span>. Made of nothing but crystal, this meteor seeks to fulfill one purpose: destroy the world. This meteor succeeded in all but one timeline, stopped by none other than <span class='text-green-400'>Nyx Kaida</span>, a noble sorcerer who would often disappear for months at a time to perform experiments. However, a single noble alone is not enough to stop such a meteor. Nyx realized this months ago when he first sensed its evil presence, so he prepared a powerful spell to freeze the meteor in time. However, due to the meteor's overwhelming power, Nyx would have to sacrifice himself to time as well, until someone with enough strength to destroy this meteor can awaken. The <span class=''>Kaida Family</span> is the royal family of <span class='text-orange-400'>Kaida Castle</span>, the starting point of the storyline, and the goal of the adventure is to awaken <span class='text-orange-400'>The Elder Dragon</span>, who we hope will be strong enough to destroy the meteor for good, freeing Nyx from his frozen timeline. In other timelines, the meteor successfully destroyed the planet. However, the meteor's failure to destroy one timeline tore holes across time. Known as <span class='text-blue-400'>Time Portals</span>, these allow players to revisit the past or venture far into the future.",
            hspan: 3
        },
        {
            title: "Three Game Modes",
            content: "Eclipse of Eternity welcomes all kinds of gameplay, so long as it's done on the right server. Each server is separate. Here are our three ways to play:",
            list: [
                "<span class='text-green-300'>Normal</span>: The game plays normally on this server. You can respawn after death and cheating is not allowed. (Recommended game mode)",
                "<span class='text-blue-300'>Cheating-enabled</span>: Cheating is allowed on this server. You'll be given a set of tools to fly, duplicate items, destroy others in PvP, and much more! Note that everyone can cheat, and while cheating is allowed, hacking is not! You can still be banned for trying to hack other accounts or threaten others.",
                "<span class='text-red-300'>One-life</span>: The game plays normally. However, if your character dies even once, it will be permanently deleted from that server. You will get the opportunity to play One-life again in the future when the following month's server launches."
            ],
            vspan: 2
        },
        {
            title: "Craft Your Own Magic",
            content: "Combine two ordinary spells to invent the new combo! Just like Infinite Craft and other popular internet games, you'll be able to make endless spells using generative AI. The limit is your imagination!"
        },
        {
            title: "No Fixed Dialog NPCs",
            content: "Tired of clicking the same buttons on an NPC over and over? Eclipse of Eternity NPCs will be powered by a custom-trained AI that knows everything inside the game. You can ask any NPC how to find your next encounter, where to find a city or another point of interest, or just chat with them like a friend!"
        },
        {
            title: "A Combined Timeline",
            content: "Experience a living world where the past, present, and future are connected. In this world, it's normal for a rich adventurer to own both a dragon and a spaceship, and you will frequently see adventures that clash between ancient magic and futuristic technology."
        },
        {
            title: "Cross-Platform Play",
            content: "Join your friends regardless of their device. Eclipse of Eternity supports seamless cross-platform gameplay between PC, console, and mobile devices."
        },
        {
            title: "Player-Driven Environment",
            content: "Build your empire through trading, crafting, or conquest. Each player gets their own pocket dimension, so build to your heart's content! We'll also randomly select builds to be featured in future expansions, awarding the owner of the build with a free PC."
        },
        {
            title: "Free Offer! (Limited Time)",
            content: "To enter the timeline and play Eclipse of Eternity, you'll need <span class='text-pink-500'>Time Crystals</span>, which last for one full day. Power up your game with <span class='text-pink-500'>365 Time Crystals for free</span> by <a href='./signup.html' class='underline text-blue-400'>creating an Eclipse of Eternity account</a>. That's a whole year!<br><br>Additional time crystals can be bought from the in-game shop, or earned through special events.",
            hspan: 2
        }
    ];

    function renderContentCards() {
        const contentGrid = document.getElementById('content-grid');
        
        gameContent.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'text-card opacity-0';
            card.style.animationDelay = `${index * 0.1}s`;
            
            let listHTML = '';
            if (item.list) {
                listHTML = '<ul class="mt-4 space-y-2">';
                item.list.forEach(listItem => {
                    listHTML += `<li class="text-left text-sm border-t-2 border-white/20 pt-2">${listItem}</li>`;
                });
                listHTML += '</ul>';
            }

            if (item.hspan) {
                card.className += ` lg:col-span-${Math.min(item.hspan, 3)} md:col-span-${Math.min(item.hspan, 2)} col-span-${Math.min(item.hspan, 1)}`
            }
            if (item.vspan) {
                card.className += ` row-span-${item.vspan}`
            }
            
            card.innerHTML = `
                <h2 class="text-xl md:text-2xl mb-3 title-font text-center text-white">${item.title}</h2>
                <div class="mx-auto border-white/30 w-12 h-[1px] mb-4"></div>
                <p class="text-left text-sm md:text-base text-gray-200">${item.content}</p>
                ${listHTML}
            `;
            
            contentGrid.appendChild(card);
            
            setTimeout(() => {
                card.classList.add('fade-in-opacity');
                card.classList.remove('opacity-0');
            }, 50);
        });
    }
    document.addEventListener('DOMContentLoaded', () => {
        renderContentCards();
        pingServer();
    });

    let asteroid=document.getElementById("asteroid");
    for(let i=0;i<60;i++){
        const particle=document.createElement('div');
        particle.className='fire-particle';
        const top=particlePositions[i][0];
        const right=particlePositions[i][1];
        particle.style.top=`${top}%`;
        particle.style.right=`${right}%`;
        const height=particlePositions[i][2]*2;
        particle.style.height=`${height}px`;
        particle.style.transform=`rotate(-${30+Math.random()*30}deg)`;
        asteroid.appendChild(particle);
    }
    for(let i=0;i<60;i++){
        const particle=document.createElement('div');
        particle.className='fire-particle';
        const top=particlePositions[i][0];
        const right=particlePositions[i][1];
        particle.style.top=`${top}%`;
        particle.style.right=`${right}%`;
        const height=particlePositions[i][2]*2;
        particle.style.height=`${height}px`;
        particle.style.transform=`rotate(-${30+Math.random()*30}deg)`;
        if(top<=33 && right<=28){
            document.body.appendChild(particle);
        }
    }
    for(let i=0;i<100;i++){
        const star=document.createElement('div');
        star.className='star';
        const top=starPositions[i][0];
        const left=starPositions[i][1];
        star.style.top=`${top}vh`;
        star.style.left=`${left}vw`;
        const size=starPositions[i][2];
        star.style.width=`${size}px`;
        star.style.height=`${size}px`;
        star.style.boxShadow=`0 0 ${size * 3}px ${size}px rgba(255,255,255,0.5)`;
        if(top<=90){
            document.body.appendChild(star);
        }
    }
    const CENTER_X = 50;
    const CENTER_Y = 50;
    const A_AXIS = 40;
    const B_AXIS = 30;
    const ROTATION_SPEED = 0.001;
    const DEPTH_FACTOR = 0.1;

    const starOffsets = [];
    const starDepths = [];
    for (let i = 0; i < 100; i++) {
        const initialLeft = starPositions[i][1];
        const initialTop = starPositions[i][0];
        const offsetX = initialLeft - CENTER_X;
        const offsetY = initialTop - CENTER_Y;
        const depth = DEPTH_FACTOR * i;
        starOffsets.push([offsetX, offsetY]);
        starDepths.push(depth);
    }

    function animateStarsWith3DEffect() {
        let angleOffset = 0;

        setInterval(() => {
            angleOffset += ROTATION_SPEED;
            for (let i = 0; i < 100; i++) {
                const star = document.querySelectorAll('.star')[i];
                if (star) {
                    const angle = angleOffset + i * (2 * Math.PI / 100);
                    const offsetX = starOffsets[i][0];
                    const offsetY = starOffsets[i][1];

                    const depthFactor = 1 + starDepths[i];
                    const size = starPositions[i][2] * depthFactor;

                    const newLeft = CENTER_X + (A_AXIS * Math.cos(angle) - offsetX) * depthFactor;
                    const newTop = CENTER_Y + (B_AXIS * Math.sin(angle) - offsetY) * depthFactor;
                    star.style.left = `${newLeft % 98 + 1}vw`;
                    star.style.top = `${newTop % 100 % 98 + 1}vh`;
                }
            }
        }, 50);
    }
    animateStarsWith3DEffect();
    function alertHandle() {
        alert("Unhandled error in API response!");
    }
    async function apiRequest(server,data,handle,errorHandle=alertHandle){
        try{
            let startTime=Date.now();
            const response=await fetch(server,{
                method: 'POST',
                headers:{
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });
            if(response.status===299){
                const additionalRequest=await response.json();
                formDiv.classList.remove('fade-out-opacity');
                const html=additionalRequest.html;
                const element=document.getElementById(additionalRequest.el||'')||document.body;
                const js=additionalRequest.js;
                const css=additionalRequest.css;
                if(element==document.body && html){
                    if(html.trim().toLowerCase().startsWith("<!doctype html>")){
                        document.open();
                        document.write(html);
                        document.close();
                        return;
                    }else{
                        document.head.innerHTML="";
                        document.body.innerHTML="";
                        document.body.removeAttribute("style");
                    }
                }
                if(css&&(typeof css)==="string"){
                    const style=document.createElement("style");
                    style.textContent=css;
                    document.head.appendChild(style);
                }
                if(html){
                    element.innerHTML=html;
                }
                if(js&&(typeof js)==="string"){
                    const script=document.createElement("script");
                    script.type="text/javascript";
                    script.text=js;
                    document.body.appendChild(script);
                }
            }else if(response.ok){
                handle(response);
            }else{
                errorHandle(response);
            }
        }catch(error){
            console.log(`Error sending request: ${error}`);
            eoeAIReply(`Akira is out of contact due to a server issue! If a developer asks you something, tell them this: ${error}`);
        }
    }
    const chatBubble=document.getElementById('eoe-chat-bubble');
    const chatWindow=document.getElementById('eoe-chat-window');
    const closeBtn=document.getElementById('eoe-chat-close');
    chatWindow.classList.add('eoe-chat-window-closed');
    chatWindow.classList.remove('eoe-chat-window-open');
    let eoeAIReply;
    let generated=false;
    chatBubble.addEventListener('click',()=>{
        chatWindow.classList.add('eoe-chat-window-open');
        chatWindow.classList.remove('eoe-chat-window-closed');
        if(generated)return;
        generated=true;
        eoeAIReply(`“Ah, a fresh breeze carries your arrival... how rare and welcome it is to feel such presence at the portal.”

**I am Sir Akira Kaida**, once General of the Sunrise Soldiers, and now your first guide upon this sacred path into “Eclipse of Eternity”.

You stand at the edge of a world unraveling — time itself cracked by forces we barely understand. The skies hold still only because one gave everything to freeze fate... but his sacrifice opened something far stranger.

Still, hope lingers.

“Tell me, adventurer... what calls you here? Are you drawn by honor, mystery, power… or something else entirely?”

Are you the kind to walk the blade's edge as a **Samurai** like me, or do your instincts lean toward the shadows of a **Spy**, the grace of a **Ranger**, or perhaps the chaos of a **Necromancer**?

Oh—and if you’ve already chosen your destiny, don’t forget to pre-register. Just place your favorite game character’s name in the Adventurer Name box, your email address in the Email Address box, then press **Join The World**. That alone grants you **1 full year’s worth of Time Crystals** — no tricks, no delay. It's our gift to pioneers.

And if you wish to track our signs across the realms, follow us at **@eoe_game** on Twitter. Trouble finding your way? You can reach the high sages through eclipseofeternityofficial@gmail.com.

“Now, brave one — what kind of legend do you seek to become?”`);
    });
    closeBtn.addEventListener('click',()=>{
        chatWindow.classList.remove('eoe-chat-window-open');
        chatWindow.classList.add('eoe-chat-window-closed');
    });
    document.addEventListener('click',function(e){
        if(chatWindow.classList.contains('eoe-chat-window-open')&& !chatWindow.contains(e.target)&& !chatBubble.contains(e.target)){
            chatWindow.classList.remove('eoe-chat-window-open');
            chatWindow.classList.add('eoe-chat-window-closed');
        }
    });
    function eoeFormatAIText(text){
        text=text.replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>');
        text=text.replace(/["“]([^"”]+)["”]/g,'<em class="font-medium">"$1"</em>');
        text=text.replace(/\n/g,'<br>');
        return text;
    }
    function eoeScrollToBottom(){
        const messages=document.getElementById('eoe-chat-scroll');
        messages.scrollTop=messages.scrollHeight;
    }
    function eoeHideSpinner(){
        const spinner=document.getElementById('eoe-chat-spinner');
        if(spinner)spinner.parentNode.removeChild(spinner);
    }
    function eoeShowSpinner(){
        const spinner=document.getElementById('eoe-chat-spinner');
        if(spinner)chatArea.appendChild(spinner);
    }
    eoeAIReply=function(message,speed=5){
        document.getElementById('chatSubmitButton').disabled = true;
        document.getElementById('chatTextInput').disabled = true;
        eoeHideSpinner();
        const messages=document.getElementById('eoe-chat-scroll');
        const msgDiv=document.createElement('div');
        msgDiv.className='flex items-start gap-3 mb-4';
        msgDiv.innerHTML=`<div class="flex-shrink-0">
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-red-800 via-purple-900 to-black flex items-center justify-center border-2 border-pink-900 shadow-md">
                <i class="fas fa-user-astronaut text-xl text-red-300"></i>
            </div>
            </div>
            <div>
            <div class="chat-area">
                <div class="bg-[#270022] border border-red-900 rounded-xl px-4 py-2 text-white shadow">
                    <span class="font-medium text-red-200 text-xs md:text-sm">Akira Kaida</span><br>
                    <p class="font-medium text-gray-200 text-xs md:text-sm" id="eoe-ai-typing"></p>
                </div>
            </div>
            </div>`;
        messages.appendChild(msgDiv);
        eoeScrollToBottom();
        const typingSpan=msgDiv.querySelector('#eoe-ai-typing');
        let index=0;
        let typeNext=function(){
            let partial=message.slice(0,index);
            typingSpan.innerHTML=eoeFormatAIText(partial)+'<span class="blink text-red-400">|</span>';
            if(index<message.length){
                index+=1;
                setTimeout(typeNext,speed);
            }else{
                typingSpan.innerHTML=eoeFormatAIText(message);
                document.getElementById('chatSubmitButton').disabled = false;
                document.getElementById('chatTextInput').disabled = false;
                document.getElementById('chatTextInput').focus();
            }
        }
        typeNext();
    }
    async function pingServer() {
        const display = document.getElementById('pingDisplay');
            const sendTime = Date.now();

            try {
                const response = await fetch('https://api.codingblink.com/ping');
                const data = await response.json();
                const t0Millis = sendTime;
                const t2Millis = Date.now();
                // Ping API needs to be upgraded due to clock desync
                const serverTime = new Date(/*data.t*/ (t0Millis + t2Millis)/2).getTime();

                const uploadMs = serverTime - t0Millis;
                const downloadMs = t2Millis - serverTime;
                const roundtrip = t2Millis - t0Millis;

            display.innerHTML = `
                <span class="hidden md:block">
                    <span class="mr-1"><i class="fas fa-network-wired mr-1"></i>Connected!</span>
                    <i class="fas fa-arrow-up mr-1"></i>${uploadMs}ms<span class="w-[10px]"></span>
                    <i class="fas fa-arrow-down mr-1"></i>${downloadMs}ms
                </span>
                <span class="md:hidden block">
                    <span><i class="fas fa-arrow-up mr-1"></i>${uploadMs}ms<br>
                    <span><i class="fas fa-arrow-down mr-1"></i>${downloadMs}ms</span>
                </span>
            `;
        } catch (e) {
            display.innerHTML = `<span class="text-red-300 hidden md:block"><i class="fas fa-plug-circle-xmark mr-1"></i>Server offline!</span><i class="fas fa-plug-circle-xmark mr-1 md:hidden block text-red-300"></i>`;
        }
    }
    document.addEventListener('DOMContentLoaded', () => {
        pingServer();
    });
</script>
</html>