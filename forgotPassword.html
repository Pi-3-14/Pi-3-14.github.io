<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="robots" content="noindex">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Software developer and coding tutor Piâ€”offering custom projects, private lessons, and creator of Eclipse of Eternity (coming Dec 2028)." />
    <title>Reset Password - Coding Blink</title>
    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Open Sans' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <style>
        .flashing {
            animation: flashing 2s infinite;
        }
        @keyframes flashing {
            0% {
                opacity: 1;
            }
            50% {
                opacity: 0;
            }
            100% {
                opacity: 1;
            }
        }
    </style>
</head>

<body class="bg-gradient-to-r from-indigo-100 via-gray-100 to-indigo-100 text-gray-800 overflow-x-hidden">
    <a href="#main" onclick="document.getElementById('first-link-in-main-content').focus();" class="sr-only focus:not-sr-only absolute left-4 top-4 bg-white text-black font-bold px-4 py-2 rounded shadow z-50">Skip to main content</a>
    <nav class="bg-white shadow-md p-4 sticky top-0 z-50">
        <div class="logodiv max-w-7xl mx-auto flex justify-between items-center">
            <a href="./index.html" class="home-link inline-block hover:border-2 hover:px-3 hover:py-1">
                <h2 class="logo text-2xl font-bold cursor-pointer">
                    <nobr>
                        <div class="logotext">
                            &gt;
                            <div class="logocursor inline">|</div>
                        </div>
                    </nobr>
                </h2>
            </a>
            <ul id="desktop-nav" class="flex space-x-2 overflow-auto ml-2">
                <li><a href="idea/index.html" class="nav-button nav-button-usable px-4 py-2 rounded-2xl bg-gradient-to-r from-blue-500 to-indigo-500 text-white">Idea to App</a></li>
                <li><a href="https://codingblink.com/eclipse-of-eternity" class="nav-button nav-button-usable px-4 py-2 rounded-2xl bg-gradient-to-r from-purple-500 to-pink-500 text-white">Eclipse of Eternity</a></li>
                <li><a href="tutoring/index.html" class="nav-button nav-button-usable px-4 py-2 rounded-2xl bg-gradient-to-r from-green-500 to-teal-500 text-white">Coding Tutoring</a></li>
                <li><a href="job/index.html" class="nav-button nav-button-usable px-4 py-2 rounded-2xl bg-gradient-to-r from-yellow-500 to-orange-500 text-white">Get a Coding Job</a></li>
                <li><a href="amazon/index.html" class="nav-button nav-button-usable px-4 py-2 rounded-2xl bg-gradient-to-r from-red-500 to-pink-500 text-white">Amazon Store</a></li>
            </ul>
        </div>
    </nav>

    <div id="custom-tooltip" class="fixed main-section pointer-events-none fixed z-50 px-3 py-1 bg-black text-white border border-white rounded-md text-sm whitespace-nowrap opacity-0 transition-opacity duration-150">
    </div>

    <main>
        <!-- === SUCCESS CARD === -->
        <div id="successCard" class="hidden card bg-white shadow-lg rounded-2xl p-8 max-w-lg mt-24 mb-12 max-w-6xl mx-auto text-center">
            <h2 class="text-3xl md:text-4xl font-semibold text-green-800 mb-4">
                <i class="fas fa-check-circle mr-2"></i>Password reset successful!
            </h2>
        </div>

        <!-- === ERROR CARD === -->
        <div id="errorCard" class="card hidden bg-white shadow-lg rounded-2xl p-8 max-w-lg mt-24 mb-12 max-w-6xl mx-auto text-center">
            <h2 class="text-3xl md:text-4xl font-semibold text-red-600 mb-4">
                <i class="fas fa-triangle-exclamation mr-2"></i>Error
            </h2>
        </div>

        <!-- === PROCESSING CARD === -->
        <div id="processingCard" class="card hidden bg-white shadow-lg rounded-2xl p-8 max-w-lg mt-24 mb-12 max-w-6xl mx-auto text-center">
            <h2 class="text-3xl md:text-4xl font-semibold text-yellow-500 flex justify-center items-center">
                <i class="fas fa-spinner mr-2 flashing"></i><span>Resetting password</span><span id="dots">...</span>
            </h2>
        </div>

        <!-- === RESET PASSWORD FORM === -->
        <div id="resetFormCard" class="card bg-white shadow-lg rounded-2xl p-8 max-w-lg mt-24 mb-12 max-w-6xl mx-auto">
            <h2 class="text-3xl md:text-4xl font-semibold text-blue-600 mb-6 text-center">
                <i class="fas fa-key mr-2"></i>Reset Your Password
            </h2>
            
            <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <p class="text-sm text-blue-800">
                    <i class="fas fa-info-circle mr-2"></i>
                    This password will work across all CodingBlink sites, including GPU Sniper and Eclipse of Eternity.
                </p>
            </div>

            <form id="resetForm" class="space-y-6">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-envelope mr-1"></i>Confirm Your Email Address
                    </label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        required 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                        placeholder="Enter your email address"
                    >
                </div>

                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-lock mr-1"></i>New Password
                    </label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        required 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                        placeholder="Enter your new password"
                        minlength="8"
                    >
                </div>

                <div>
                    <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-lock mr-1"></i>Confirm New Password
                    </label>
                    <input 
                        type="password" 
                        id="confirmPassword" 
                        name="confirmPassword" 
                        required 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                        placeholder="Confirm your new password"
                        minlength="8"
                    >
                </div>

                <button 
                    type="submit" 
                    id="resetButton" 
                    class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-semibold px-8 py-3 rounded-lg shadow-lg transform hover:scale-105 transition-all duration-200"
                >
                    <i class="fas fa-key mr-2"></i>Reset Password
                </button>
            </form>
        </div>

        <section class="py-16 px-4 md:px-0 main-section">
            <div class="max-w-6xl mx-auto text-center">
                <p class="text-gray-500" id="infoText">Please confirm your email address and enter your new password.</p>
                <br><a href="index.html" id="backToHome" class="text-blue-600 hover:text-blue-800">Back to homepage</a>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="fixed bottom-0 w-full bg-gray-200 text-center py-6 mt-10">
        <p class="text-gray-600">&copy; 2025 codingblink.com. All rights reserved.</p>
        <div id="pingDisplay" class="relative bottom-20 left-4 text-sm text-gray-600 flex items-center">
            <span><i class="fas fa-wifi mr-1"></i>Pinging server...</span>
        </div>
    </footer>

    <script>
        const dots = document.getElementById('dots');
        const success = document.getElementById('successCard');
        const error = document.getElementById('errorCard');
        const processing = document.getElementById('processingCard');
        const resetFormCard = document.getElementById('resetFormCard');
        const resetForm = document.getElementById('resetForm');
        const txt = document.getElementById('infoText');
        const homeBtn = document.getElementById('backToHome');
        let dotsTimer;

        // Get token from URL
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('t');

        // Check if token exists
        if (!token) {
            showError("Invalid reset link. Please try requesting a new password reset.");
        }

        // Form validation and submission
        resetForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            // Validate email
            if (!email) {
                showError("Please enter your email address.");
                return;
            }

            // Validate passwords match
            if (password !== confirmPassword) {
                showError("Passwords do not match. Please try again.");
                return;
            }

            // Validate password length
            if (password.length < 8) {
                showError("Password must be at least 8 characters long.");
                return;
            }

            startPasswordReset(email, password);
        });

        function startPasswordReset(email, password) {
            // Hide form and show processing
            resetFormCard.classList.add('hidden');
            processing.classList.remove('hidden');
            txt.innerHTML = "Your password is being reset. Please wait...";
            
            // Start dots animation
            dotsTimer = setInterval(function(){
                dots.textContent = '.'.repeat(1+Math.floor((Date.now()%900)/300));
            }, 300);
            
            resetPassword(email, password);
        }

        async function resetPassword(email, password) {
            try {
                const response = await fetch('https://api.codingblink.com/forgotpassword', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        e: email,
                        t: token,
                        p: password
                    })
                });

                clearInterval(dotsTimer);
                processing.classList.add('hidden');

                if (response.status === 204) {
                    // Success
                    success.classList.remove('hidden');
                    txt.innerHTML = "Your password has been successfully reset! You can now log in with your new password across all CodingBlink sites.";
                } else if (response.status === 400) {
                    // Handle specific errors
                    const data = await response.json();
                    const errorCode = data.e;
                    let errorMessage = getErrorMessage(errorCode);
                    showError(errorMessage);
                } else if (response.status === 401) {
                    showError("Not authorized. Please check your email address and try again.");
                } else if (response.status === 403) {
                    showError("Access forbidden. Your account may be restricted.");
                } else {
                    showError("An unexpected error occurred. Please try again later.");
                }
            } catch (e) {
                clearInterval(dotsTimer);
                processing.classList.add('hidden');
                showError("Unable to connect to the server. Please check your internet connection and try again.");
            }
        }

        function showError(message) {
            error.classList.remove('hidden');
            resetFormCard.classList.add('hidden');
            txt.innerHTML = message;
        }

        function getErrorMessage(errorCode) {
            const accountErrors = {
                0: "Account not found. Please check your email address.",
                1: "Your account has been banned. Please contact support.",
                2: "Your account is locked. Please contact support.",
                3: "The reset link is invalid. Please request a new password reset.",
                4: "The reset link has expired. Please request a new password reset.",
                6: "Something went wrong. Please try again.",
                8: "Your password must be longer than 11 characters and have one of each: Lowercase letter (a-z), Uppercase letter (A-Z), Number (0-9), Symbol (like !:[+$,)",
                9: "Password is not allowed. Choose a password that doesn't contain patterns like '123' or weak phrases."
            };

            return accountErrors[errorCode] || "An unknown error occurred. Please try again or contact support.";
        }

        const MIN_ZOOM = 0.3;
        const ZOOM_STEP = 0.05;

        function applyZoom(zoom) {
            document.body.style.zoom = zoom;
        }

        function checkNavOverflow() {
            const nav = document.getElementById('desktop-nav');
            return nav.scrollWidth > nav.clientWidth;
        }

        function zoomOutUntilFits() {
            if (window.innerWidth < 768) {
                return;
            }
            let currentZoom = Number(document.body.style.zoom) || 1;

            function tryZoomOut() {
                if (!checkNavOverflow() || currentZoom <= MIN_ZOOM) {
                    return;
                }

                currentZoom -= ZOOM_STEP;
                currentZoom = Math.max(currentZoom, MIN_ZOOM);
                applyZoom(currentZoom);

                setTimeout(tryZoomOut, 100);
            }

            tryZoomOut();
        }

        document.addEventListener('DOMContentLoaded', () => {
            if (checkNavOverflow()) {
                zoomOutUntilFits();
            }
            window.addEventListener('resize', function() { 
                document.body.style.zoom = 1; 
                zoomOutUntilFits(); 
            });
            pingServer();
        });
        zoomOutUntilFits();

        async function pingServer() {
            const display = document.getElementById('pingDisplay');
            const sendTime = Date.now();

            try {
                const response = await fetch('https://api.codingblink.com/ping');
                const data = await response.json();
                const t0Millis = sendTime;
                const t2Millis = Date.now();
                const serverTime = new Date((t0Millis + t2Millis)/2).getTime();

                const uploadMs = serverTime - t0Millis;
                const downloadMs = t2Millis - serverTime;

                display.innerHTML = `
                    <span class="mr-1"><i class="fas fa-network-wired mr-1"></i>Connected!</span>
                    <i class="fas fa-arrow-up text-blue-500 mr-1"></i>${uploadMs}ms<span class="w-[10px]"></span>
                    <i class="fas fa-arrow-down text-green-500 mr-1"></i>${downloadMs}ms
                `;
            } catch (e) {
                display.innerHTML = `<span class="text-red-500"><i class="fas fa-plug-circle-xmark mr-1"></i>Server offline!</span>`;
            }
        }
    </script>
</body>
</html>